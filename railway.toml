# Railway Configuration
$schema: https://railway.app/railway.schema.json
version: 2

environments:
  production:
    variables:
      NODE_ENV: production
      PYTHONPATH: /app
      
services:
  backend:
    source: .
    build:
      buildCommand: cd backend && pip install -r requirements.txt
    deploy:
      startCommand: cd backend && uvicorn main:app --host 0.0.0.0 --port $PORT
      healthcheckPath: /health
    variables:
      DATABASE_URL: ${{MongoDB.DATABASE_URL}}
      REDIS_URL: ${{Redis.REDIS_URL}}
      OPENAI_API_KEY: ${{OPENAI_API_KEY}}
      AZURE_SPEECH_KEY: ${{AZURE_SPEECH_KEY}}
      AZURE_REGION: ${{AZURE_REGION}}
      JWT_SECRET: ${{JWT_SECRET}}
      ENVIRONMENT: production
      PYTHONPATH: /app
      
  frontend:
    source: .
    build:
      buildCommand: cd frontend && npm ci && npm run build
    deploy:
      startCommand: cd frontend && npx serve -s build -l $PORT
    variables:
      REACT_APP_API_URL: ${{backend.RAILWAY_PUBLIC_DOMAIN}}
      REACT_APP_ENVIRONMENT: production
      
  database:
    source: mongodb
    
  redis:
    source: redis